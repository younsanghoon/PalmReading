# 작업 기록: 테스트 페이지 라우팅 문제 해결

날짜: 2024-06-13

## 발견된 문제

1. 메인 페이지에서 각 테스트 버튼 클릭 시 테스트 페이지로 이동하지 않는 문제 발생
   - 동물상 테스트, MBTI 테스트, 에겐-테토 테스트, 손금 테스트 등 모든 테스트 페이지 이동 불가
   - 서버 로그에서 `/PalmReading/` 경로로 요청이 발생하는 것을 확인

2. 로그 분석을 통한 문제 확인
   - 경로 정규화 과정에서 슬래시(/) 처리 문제 발생
   - 일부 경로에서 슬래시가 누락되어 올바른 라우팅이 되지 않음
   - 개발 환경과 배포 환경 간의 경로 처리 불일치

## 수행한 작업

1. **App.tsx의 useBasePath 훅 수정**
   - 경로 정규화 로직 개선
   ```typescript
   // 경로가 이미 슬래시로 시작하는지 확인
   const normalizedTo = to.startsWith('/') ? to : `/${to}`;
   console.log("[Router] Normalized destination:", normalizedTo);
   
   // 개발 환경에서는 base path를 추가하지 않음
   const newPath = isDev 
     ? normalizedTo 
     : (normalizedTo === "/" ? basePath : `${basePath}${normalizedTo}`);
   ```
   
   - 중복 네비게이션 방지 로직 추가
   ```typescript
   // 현재 경로와 새 경로가 같은지 확인
   if (loc === newPath) {
     console.log("[Router] Already at this location, not navigating");
     return;
   }
   ```

2. **home.tsx의 handleTestClick 함수 수정**
   - 경로 정규화 로직 추가
   ```typescript
   // 경로가 슬래시로 시작하는지 확인하고, 시작하지 않으면 슬래시 추가
   const normalizedHref = href.startsWith('/') ? href : `/${href}`;
   console.log("[Home] Normalized href:", normalizedHref);
   ```
   
   - 오류 처리 추가
   ```typescript
   try {
     navigate(normalizedHref);
     console.log("[Home] Navigation completed");
   } catch (error) {
     console.error("[Home] Navigation error:", error);
   }
   ```

## 문제 해결 과정

1. **로그 분석**
   - 서버 로그에서 `/PalmReading/` 경로로 요청이 발생하는 것을 확인
   - App.tsx의 useBasePath 훅에서 경로 정규화 과정 로그를 확인
   - 일부 경로에서 슬래시가 누락되어 있음을 발견

2. **경로 정규화 개선**
   - 모든 경로가 슬래시(/)로 시작하도록 정규화 로직 추가
   - 개발 환경과 배포 환경에서 일관된 경로 처리 보장

3. **오류 처리 강화**
   - 네비게이션 과정에서 발생할 수 있는 오류를 캐치하여 로깅
   - 중복 네비게이션 방지 로직 추가

## 결과

1. **테스트 페이지 라우팅 정상화**
   - 모든 테스트 버튼 클릭 시 해당 테스트 페이지로 올바르게 이동
   - 개발 환경과 배포 환경 모두에서 일관된 라우팅 동작 보장

2. **로깅 개선**
   - 경로 정규화 과정의 상세 로그 추가로 디버깅 용이성 향상
   - 네비게이션 오류 발생 시 명확한 로그 메시지 제공

## 다음 단계

1. 다른 페이지의 네비게이션 코드도 동일한 방식으로 리팩토링 검토
2. 라우팅 관련 유틸리티 함수 도입 고려 (경로 정규화 등)
3. 전체 애플리케이션에서 일관된 라우팅 패턴 적용 