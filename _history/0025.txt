# 작업 기록: 404 에러 해결 및 로깅 개선

날짜: 2024-06-12

## 발견된 문제

1. 개발 서버 실행 후 404 에러 발생
   - 원인: 개발 환경과 배포 환경(GitHub Pages)의 경로 불일치
   - 주요 문제점:
     - client/index.html에서 manifest.json, icon 등의 경로에 "/PalmReading/" 접두사 포함
     - client/public/manifest.json에서도 경로에 "/PalmReading/" 접두사 포함
     - 개발 환경에서는 이러한 접두사가 불필요하고 오히려 404 에러 발생 원인

2. 로그 분석을 통한 문제 확인
   - App.tsx의 useBasePath 훅에서 경로 정규화 과정에서 문제 발생
   - 서버 측 로깅이 부족하여 문제 원인 파악이 어려움

## 수행한 작업

1. **클라이언트 경로 수정**
   - `client/index.html` 수정:
     - manifest.json 경로: `/PalmReading/manifest.json` → `/manifest.json`
     - apple-touch-icon 경로: `/PalmReading/icon-192.png` → `/icon-192.png`

   - `client/public/manifest.json` 수정:
     - start_url: `/PalmReading/` → `/`
     - 아이콘 경로: `/PalmReading/icon-192.png` → `/icon-192.png`
     - 아이콘 경로: `/PalmReading/icon-512.png` → `/icon-512.png`

2. **라우팅 로깅 개선**
   - `client/src/App.tsx` 수정:
     - 현재 URL origin 로깅 추가
     - window.location.href 로깅 추가
     - 개발 환경과 배포 환경 구분 로직 명확화

3. **서버 로깅 개선**
   - `server/vite.ts` 수정:
     - Vite 서버 설정 및 초기화 과정 로깅 추가
     - 템플릿 로딩 및 변환 과정 로깅 추가
     - 에러 처리 개선 (프로세스 종료 대신 로깅만 수행)
     - 정적 파일 서빙 과정 로깅 추가

4. **템플릿 처리 개선**
   - 개발 환경에서 manifest.json 경로에 캐시 버스팅 쿼리 파라미터 추가

## 결과

1. **404 에러 해결**
   - 개발 환경에서 모든 정적 리소스 경로가 올바르게 설정됨
   - 배포 환경(GitHub Pages)에서는 App.tsx의 useBasePath 훅을 통해 "/PalmReading" 접두사 자동 추가

2. **로깅 시스템 개선**
   - 클라이언트와 서버 모두에서 상세한 로그 확인 가능
   - 라우팅 과정의 각 단계별 로그 추가로 문제 발생 시 빠른 원인 파악 가능
   - 템플릿 처리 및 변환 과정의 로그 추가로 HTML 관련 문제 디버깅 용이

## 다음 단계

1. 배포 환경에서의 테스트 수행
2. 로그 데이터 분석을 통한 성능 최적화 지점 식별
3. 필요한 경우 환경 변수를 통한 경로 설정 자동화 검토 